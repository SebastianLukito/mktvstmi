<!doctype html>
<html lang="id">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Scoreboard - Marketing IGR vs TMI/GA United</title>
        <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
        <link rel="stylesheet" href="css/styles.css" />
        <link rel="icon" href="asset/mktlogo.png">
    </head>
    <body>
        <header class="topbar">
            <div class="topbar-inner">
                <div class="brand">
                    <span class="dot"></span> 
                    MKT IGR vs TMI/GA United
                </div>
                <nav>
                    <a class="btn ghost" href="login.html">Login</a>
                </nav>
            </div>
        </header>

        <main class="container">
            <!-- HERO memakai asset/template.jpg -->
            <section class="hero">
                <div class="bg">
                </div>

                <!-- skor overlay kiri/kanan tepat di atas template -->
                <div class="hero-score left">
                    <div id="scoreMkt" class="num">
                        0
                    </div>
                </div>
                <div class="hero-score right">
                    <div id="scoreTmi" class="num">
                        0
                    </div>
                </div>
            </section>

            <!-- TABLE -->
            <section class="panel">
                <div style="display:flex;justify-content:space-between; align-items:center;gap:12px;margin-bottom:10px">
                    <h3 style="letter-spacing:.6px">Rekap Pertandingan</h3>
                    <span class="badge" id="totalBadge">0 pertandingan</span>
                </div>
            <table class="table" id="tableBodyWrap">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Marketing IGR</th>
                        <th>TMI/GA United</th>
                        <th>Pemenang</th>
                        <th>Waktu</th>
                    </tr>
                </thead>
                <tbody id="tbodyMatches">
                <!-- diisi via JS -->
                </tbody>
            </table>
            </section>

            <div class="footer">
                Â©Sebastianus Lukito
            </div>
        </main>

    <!-- Firebase + App (read-only) -->
        <script type="module">
            // === Firebase v9 modular (CDN) ===
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
            import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

            // Konfigurasi project kamu
            const firebaseConfig = {
                apiKey: "AIzaSyBKD7JAJHbeZC76XRoJ6lzVVwe0tLGSTno",
                authDomain: "mktvstmi.firebaseapp.com",
                projectId: "mktvstmi",
                storageBucket: "mktvstmi.firebasestorage.app",
                messagingSenderId: "608278579245",
                appId: "1:608278579245:web:4320f16e2a637343d110a4",
                measurementId: "G-0TJKX3M8L2"
            };

            // Init
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            // Elemen UI
            const tbody = document.getElementById('tbodyMatches');
            const badge = document.getElementById('totalBadge');
            const elM = document.getElementById('scoreMkt');
            const elT = document.getElementById('scoreTmi');

            // Stream data: koleksi 'matches' diurutkan terbaru
            const q = query(collection(db, 'matches'), orderBy('createdAt','desc'));
            onSnapshot(q, snap => {
            let rows = [];
            let mWin = 0, tWin = 0;
            let i = 0;

            snap.forEach(doc => {
                const d = doc.data(); i++;
                const winner = d.mkt === 'W' ? 'Marketing IGR' : (d.tmi === 'W' ? 'TMI/GA United' : '-');
                if (d.mkt === 'W') mWin++;
                if (d.tmi === 'W') tWin++;

                const ts = d.createdAt?.toDate?.() ? d.createdAt.toDate() : (d.createdAt || new Date());
                rows.push(`
                <tr>
                    <td>${i}</td>
                    <td>${d.mkt === 'W' ? '<span class="badge ok">MENANG</span>' : '<span class="badge no">KALAH</span>'}</td>
                    <td>${d.tmi === 'W' ? '<span class="badge ok">MENANG</span>' : '<span class="badge no">KALAH</span>'}</td>
                    <td>${winner}</td>
                    <td>${new Intl.DateTimeFormat('id-ID',{dateStyle:'medium', timeStyle:'short'}).format(ts)}</td>
                </tr>
                `);
            });

            tbody.innerHTML = rows.join('') || `<tr><td colspan="5" style="color:#86a2d2;padding:16px">Belum ada data.</td></tr>`;
            badge.textContent = `${i} pertandingan`;
            elM.textContent = mWin;
            elT.textContent = tWin;
            });
        </script>
    </body>
</html>
